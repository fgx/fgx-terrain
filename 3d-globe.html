<!doctype html>
<html lang=en>
<head>
<title>3D Globe</title>
<meta charset=utf-8>
</head>
<body>
<script src = http://mrdoob.github.io/three.js/build/three.min.js ></script>
<script src = http://mrdoob.github.io/three.js/examples/js/controls/TrackballControls.js ></script>
<script>
	var renderer, scene, camera, controls, heightMap;

	init();
	animate();

	function init() {
		document.body.style.cssText = 'margin: 0; overflow: hidden; }';

		renderer = new THREE.WebGLRenderer( { alpha: 1, antialias: true, clearColor: 0xffffff }  );
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );
		scene = new THREE.Scene();

		camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
		camera.position.set( 100, 100, 100 );
		controls = new THREE.TrackballControls( camera, renderer.domElement );

// ocean
		var material = new THREE.MeshNormalMaterial( { opacity: 0.85, shading: THREE.SmoothShading, transparent: true} );
		var geometry = new THREE.SphereGeometry( 62, 100, 50 );
		var mesh = new THREE.Mesh( geometry, material );
		scene.add( mesh );

		heightMap = document.createElement('img' )
		heightMap.src = '0/0/0.png';
		heightMap.onload = initCanvas;
	}

	function initCanvas() {
		var canvas = document.createElement( 'canvas' );
		canvas.width = canvas.height = 256;
		var context = canvas.getContext( '2d' );
		context.drawImage( heightMap, 0, 0 );
		var imgd = context.getImageData( 0, 0, 256,	256 );
		var pix = imgd.data;
		var data = new Float32Array( 65536 );

		// var mapTexture = THREE.ImageUtils.loadTexture( 'http://b.tile.openstreetmap.org/0/0/0.png' );
		var material = new THREE.MeshNormalMaterial( { shading: THREE.SmoothShading } );
		var geometry = new THREE.SphereGeometry( 40, 255, 255, 0, Math.PI * 2, 0.087, 2.967);
		var verts = geometry.vertices;
		var all, j = 0;
		for (var i = 0, len = pix.length; i < len; i += 4) {
			all = pix[i] + pix[i + 1] + pix[i + 2];
			verts[j++].multiplyScalar( 1 + 0.005  * all );
		}
		var mesh = new THREE.Mesh( geometry, material );
		mesh.geometry.computeFaceNormals();
		mesh.geometry.computeVertexNormals();
		scene.add( mesh );
	}

	function animate() {
		requestAnimationFrame( animate );
		controls.update();
		renderer.render( scene, camera );
	}
</script>
</body>
</html>