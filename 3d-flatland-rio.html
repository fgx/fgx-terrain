<!doctype html>
<html lang=en>
<head>
<title>FGx Terrain ~ 3D Flatland Demo</title>
<meta charset=utf-8>
</head>
<body>
<script src = http://mrdoob.github.io/three.js/build/three.min.js ></script>
<script src = http://mrdoob.github.io/three.js/examples/js/controls/TrackballControls.js ></script>
<script>
	var renderer, scene, camera, controls, heightMap;

	init();
	animate();

	function init() {
		document.body.style.cssText = 'margin: 0; overflow: hidden; }';

		renderer = new THREE.WebGLRenderer( { alpha: 1, antialias: true, clearColor: 0xffffff }  );
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );
		scene = new THREE.Scene();

		camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
		camera.position.set( 0, 100, 60 );
		controls = new THREE.TrackballControls( camera, renderer.domElement );

// ocean
		// var material = new THREE.MeshNormalMaterial( { opacity: 0.85, shading: THREE.SmoothShading, transparent: true} );
		// var geometry = new THREE.SphereGeometry( 62, 100, 50 );
		// var mesh = new THREE.Mesh( geometry, material );
		// scene.add( mesh );

		heightMap = document.createElement('img' )
		heightMap.src = '8/104/55.png';
		heightMap.onload = initCanvas;
	}

	function initCanvas() {
		var canvas = document.createElement( 'canvas' );
		canvas.width = canvas.height = 661;
		var context = canvas.getContext( '2d' );
		context.drawImage( heightMap, 0, 0 );
		var imgd = context.getImageData( 0, 0, 661, 661 );
		var pix = imgd.data;
		var data = new Float32Array( 661 * 661 );

		var mapTexture = THREE.ImageUtils.loadTexture( 'http://mt1.google.com/vt/lyrs=s&x=104&y=55&z=7' );
		var material = new THREE.MeshBasicMaterial( { shading: THREE.SmoothShading, map: mapTexture } );
		var geometry = new THREE.PlaneGeometry( 200, 200, 660, 660 );
		geometry.applyMatrix( new THREE.Matrix4().makeRotationX( -0.5 * Math.PI ) );
		var verts = geometry.vertices;
		var all, j = 0;
		for (var i = 0, len = pix.length; i < len; i += 4) {
			all = pix[i] + pix[i + 1] + pix[i + 2];
			verts[j++].y = -30 + 0.005  * all;
		}
		var mesh = new THREE.Mesh( geometry, material );
		
		mesh.geometry.computeFaceNormals();
		mesh.geometry.computeVertexNormals();
		scene.add( mesh );
	}

	function animate() {
		requestAnimationFrame( animate );
		controls.update();
		renderer.render( scene, camera );
	}
</script>
</body>
</html>